<div class="ui-g">
  <div class="ui-g-12 no-padding">
    <div class="xd no-padding">
      <div style="margin-bottom:0" class="panel panel-default">
        <div class="panel-heading">
          <div class="row">
            <div class="col-md-12">
              <h2 class="panel-title pull-left">
                {{ formTitle }}
              </h2>
            </div>
          </div>
        </div>

        <div class="panel-body">
          <div class="form-horizontal">
            <p-tabView
              (onChange)="onTabChange($event)"
              [activeIndex]="activeIndex"
            >
              <p-tabPanel header="Product Information">
                <form novalidate [formGroup]="form">
                  <div class="form-group">
                    <label for="" class="control-label col-md-2"
                      >Product Type</label
                    >
                    <div class="col-md-4">
                      <select
                        type="text"
                        name="productTypeId"
                        formControlName="productTypeId"
                        id="productTypeId"
                        class="form-control"
                      >
                        <option value="">-- Select Product Type --</option>
                        <option
                          *ngFor="let row of productTypeList"
                          [value]="row.productTypeId"
                        >
                          {{ row.productTypeName }}
                        </option>
                      </select>
                    </div>
                    <label for="" class="control-label col-md-2">
                      Product Code
                    </label>
                    <div class="col-md-4">
                      <input
                        type="text"
                        formControlName="productCode"
                        name="productCode"
                        class="form-control"
                      />
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="" class="control-label col-md-2">
                      Product Name
                    </label>
                    <div class="col-md-4">
                      <input
                        type="text"
                        formControlName="productName"
                        name="productName"
                        class="form-control"
                      />
                    </div>
                    <label for="" class="control-label col-md-2">
                      Interest Repayment
                    </label>
                    <div class="col-md-4">
                      <select
                        type="text"
                        name="paymentType"
                        formControlName="paymentType"
                        id="paymentType"
                        class="form-control"
                      >
                        <option value=""
                          >-- Select Interest Repayment --</option
                        >
                        <option
                          value="1"
                        >
                         Spread
                        </option>
                      </select>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="" class="control-label col-md-2">
                      Schedule Method
                    </label>
                    <div class="col-md-4">
                      <select
                        type="text"
                        name="scheduleTypeId"
                        formControlName="scheduleTypeId"
                        id="scheduleTypeId"
                        class="form-control"
                      >
                        <option value="">-- Select Schedule Method --</option>
                        <option
                          *ngFor="let row of scheduleTypes"
                          [value]="row.lookupId"
                        >
                          {{ row.lookupName }}
                        </option>
                      </select>
                    </div>
                    <label for="" class="control-label col-md-2">
                      Frequency
                    </label>
                    <div class="col-md-4">
                      <select
                        type="text"
                        name="frequencyTypeId"
                        formControlName="frequencyTypeId"
                        id="frequencyTypeId"
                        (change)="onFrequencyTypeChanged($event.target.value)"
                        class="form-control"
                      >
                        <option value="">-- Select Frequency --</option>
                        <option
                          *ngFor="let row of frequencyTypeList"
                          [value]="row.lookupId"
                        >
                          {{ row.lookupName }}
                        </option>
                      </select>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="" class="control-label col-md-2">
                      Collateral Type Required
                    </label>
                    <div class="col-md-4">
<!--                      <p-multiSelect-->
<!--                        [options]="AllCollateral"-->
<!--                        formControlName="allowableCollaterals"-->
<!--                        styleClass="form-control"-->
<!--                        [panelStyle]="{ minWidth: '22em' }"-->
<!--                      ></p-multiSelect>-->
                      <ng-select
                        [items]="collateralTypes"
                        bindValue="collateralTypeId"
                        bindLabel="name"
                        formControlName="allowableCollaterals"
                        [multiple]="true"
                        [closeOnSelect]="false"
                        [searchable]="true"
                      >
                        <ng-template
                          ng-option-tmp
                          let-item="item"
                          let-item$="item$"
                          let-index="index"
                        >
                          <input
                            id="item-{{ index }}"
                            type="checkbox"
                            [ngModel]="item$.selected"
                            [ngModelOptions]="{ standalone: true }"
                          />
                          {{ item.name }}
                        </ng-template>
                      </ng-select>
                    </div>
                    <!-- <label
                                            for=""
                                            class="control-label col-md-2"
                                        >
                                            Collateral Required
                                        </label>
                                        <div class="col-md-4">
                                            <select
                                                type="text"
                                                name="collateralRequired"
                                                formControlName="collateralRequired"
                                                id="collateralRequired"
                                                class="form-control"
                                            >
                                                <option value=""
                                                    >-- Select --</option
                                                >
                                                <option value="true"
                                                    >Yes</option
                                                >
                                                <option value="false"
                                                    >No</option
                                                >
                                            </select>
                                        </div> -->
                    <label for="" class="control-label col-md-2">
                      Period
                    </label>
                    <div class="col-md-4">
                      <input
                        type="number"
                        formControlName="period"
                        name="period"
                        class="form-control"
                      />
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="" class="control-label col-md-2">
                      Collateral(% of loan amt)
                    </label>
                    <div class="col-md-4">
                      <input
                        type="number"
                        formControlName="collateralPercentage"
                        name="collateralPercentage"
                        class="form-control"
                      />
                    </div>
                    <label for="" class="control-label col-md-2">
                      Interest Type
                    </label>
                    <div class="col-md-4">
                      <select
                        name="interestType"
                        id=""
                        class="form-control"
                        [(ngModel)]="interestType"
                        [ngModelOptions]="{ standalone: true }"
                      >
                        <option value="1">Flat Interest Rate</option>
                        <option value="2">Risk based Interest</option>
                      </select>
                    </div>
                  </div>
                  <div class="form-group">
                    <ng-container *ngIf="interestType == '1'">
                      <label for="" class="control-label col-md-2">
                        Interest Rate(Annual)
                      </label>
                      <div class="col-md-4">
                        <input
                          type="number"
                          (blur)="onInterestRateChanged($event.target.value)"
                          formControlName="rate"
                          name="rate"
                          class="form-control"
                        />
                      </div>
                      <label for="" class="control-label col-md-2">
                        Interest Rate( {{ selectedFrequency }} )
                      </label>
                      <div class="col-md-4">
                        <input
                          type="number"
                          [attr.disabled]="true"
                          formControlName="poratedInterest"
                          name="poratedInterest"
                          class="form-control"
                        />
                      </div>
                    </ng-container>
                  </div>
                  <div class="form-group">
                    <label for="" class="control-label col-md-2">
                      PD Stage 2(%)
                    </label>
                    <div class="col-md-4">
                      <input
                        type="number"
                        formControlName="significant2"
                        name="significant2"
                        class="form-control"
                      />
                    </div>
                    <label for="" class="control-label col-md-2">
                      PD Stage 3(%)
                    </label>
                    <div class="col-md-4">
                      <input
                        type="number"
                        formControlName="significant3"
                        name="significant3"
                        class="form-control"
                      />
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="" class="control-label col-md-2">
                      Product Principal GL
                    </label>
                    <div class="col-md-4">
                      <p-dropdown
                        [options]="glArr"
                        formControlName="principalGL"
                        placeholder="Select an item"
                        [filter]="true"
                        [filterBy]="'label'"
                        [style]="{ width: '100%' }"
                      >
                        <ng-template let-item pTemplate="selectedItem">
                          <span
                            style="vertical-align:middle; margin-left: .5em"
                            >{{ item.label }}</span
                          >
                        </ng-template>
                        <ng-template let-x pTemplate="item">
                          <div
                            class="ui-helper-clearfix"
                            style="position: relative;height: 25px;"
                          >
                            <div style="font-size:14px;margin-top:4px">
                              {{ x.label }}
                            </div>
                          </div>
                        </ng-template>
                      </p-dropdown>
                    </div>
                    <label for="" class="control-label col-md-2">
                      Interest Income GL
                    </label>
                    <div class="col-md-4">
                      <p-dropdown
                        [options]="glArr"
                        placeholder="Select an item"
                        formControlName="interestIncomeExpenseGL"
                        [filter]="true"
                        [filterBy]="'label'"
                        [style]="{ width: '100%' }"
                      >
                        <ng-template let-item pTemplate="selectedItem">
                          <span
                            style="vertical-align:middle; margin-left: .5em"
                          >{{ item.label }}</span
                          >
                        </ng-template>
                        <ng-template let-x pTemplate="item">
                          <div
                            class="ui-helper-clearfix"
                            style="position: relative;height: 25px;"
                          >
                            <div style="font-size:14px;margin-top:4px">
                              {{ x.label }}
                            </div>
                          </div>
                        </ng-template>
                      </p-dropdown>
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="" class="control-label col-md-2">
                      Interest Receivable GL
                    </label>
                    <div class="col-md-4">
                      <p-dropdown
                        [options]="glArr"
                        placeholder="Select an item"
                        formControlName="interestReceivablePayableGL"
                        [filter]="true"
                        [filterBy]="'label'"
                        [style]="{ width: '100%' }"
                      >
                        <ng-template let-item pTemplate="selectedItem">
                          <span
                            style="vertical-align:middle; margin-left: .5em"
                          >{{ item.label }}</span
                          >
                        </ng-template>
                        <ng-template let-x pTemplate="item">
                          <div
                            class="ui-helper-clearfix"
                            style="position: relative;height: 25px;"
                          >
                            <div style="font-size:14px;margin-top:4px">
                              {{ x.label }}
                            </div>
                          </div>
                        </ng-template>
                      </p-dropdown>
                    </div>
                    <label for="" class="control-label col-md-2">
                      Weighted Risk Score
                    </label>
                    <div class="col-md-4">
                      <input
                        type="number"
                        formControlName="weightedMaxScore"
                        name="weightedMaxScore"
                        class="form-control"
                      />
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="" class="control-label col-md-2">
                      Product Limit
                    </label>
                    <div class="col-md-4">
                      <input
                        type="number"
                        formControlName="productLimit"
                        name="productLimit"
                        class="form-control"
                      />
                    </div>
                    <label for="" class="control-label col-md-2">
                      Low Risk Definition
                    </label>
                    <div class="col-md-4">
                      <input
                        type="number"
                        formControlName="lowRiskDefinition"
                        name="lowRiskDefinition"
                        class="form-control"
                      />
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="" class="control-label col-md-2">
                      Early Termination Charge (%)
                    </label>
                    <div class="col-md-4">
                      <input
                        type="number"
                        formControlName="earlyTerminationCharge"
                        name="earlyTerminationCharge"
                        class="form-control"
                      />
                    </div>
                    <label for="" class="control-label col-md-2">
                      Late Repayment Charge (%)
                    </label>
                    <div class="col-md-4">
                      <input
                        type="number"
                        formControlName="lateTerminationCharge"
                        name="lateTerminationCharge"
                        class="form-control"
                      />
                    </div>
                  </div>
                  <div class="form-group">
                    <label for="" class="control-label col-md-2">
                      Definition of default (days)
                    </label>
                    <div class="col-md-4">
                      <input
                        type="number"
                        formControlName="defaultvalue"
                        name="defaultvalue"
                        class="form-control"
                      />
                    </div>
                    <label for="" class="control-label col-md-2">
                      Charges Fee GL
                    </label>
                    <div class="col-md-4">
                      <p-dropdown
                        [options]="glArr"
                        placeholder="Select an item"
                        formControlName="feeIncomeGL"
                        [filter]="true"
                        [filterBy]="'label'"
                        [style]="{ width: '100%' }"
                      >
                        <ng-template let-item pTemplate="selectedItem">
                          <span
                            style="vertical-align:middle; margin-left: .5em"
                          >{{ item.label }}</span
                          >
                        </ng-template>
                        <ng-template let-x pTemplate="item">
                          <div
                            class="ui-helper-clearfix"
                            style="position: relative;height: 25px;"
                          >
                            <div style="font-size:14px;margin-top:4px">
                              {{ x.label }}
                            </div>
                          </div>
                        </ng-template>
                      </p-dropdown>
                    </div>
                  </div>
                </form>
              </p-tabPanel>
              <p-tabPanel
                [disabled]="otherTabDisabled"
                header="Product Fee Information"
              >
                <div class="form-group">
                  <div class="col-md-12">
                    <h2 class="panel-title pull-left">
                      Product Fee
                    </h2>
                    <div
                      style="padding-right: 5px;padding-left: 5px;width: 45px;"
                      class="col-md-1 pull-right"
                    >
                      <button
                        pButton
                        style="padding:0.5em 0"
                        type="button"
                        class="ui-button-raised ui-button-danger"
                        (click)="multipleDeleteProductFee()"
                        icon="ui-icon-delete"
                        iconPos="center"
                        pTooltip="Delete"
                        tooltipPosition="top"
                        label=""
                      ></button>
                    </div>
                    <div
                      style="padding-right: 5px;padding-left: 5px;width: 45px;"
                      class="col-md-1 pull-right"
                    >
                      <button
                        pButton
                        style="padding:0.5em 0"
                        type="button"
                        class="ui-button-raised"
                        (click)="showAddNewProductFee()"
                        icon="ui-icon-plus"
                        iconPos="center"
                        pTooltip="Add"
                        tooltipPosition="top"
                        label=""
                      ></button>
                    </div>
                    <div
                      style="padding-right: 5px;padding-left: 5px;width: 45px;"
                      class="col-md-1 pull-right"
                    >
                      <button
                        pButton
                        style="padding:0.5em 0"
                        type="button"
                        class="ui-button-raised ui-button-secondary"
                        (click)="exportProductFee()"
                        icon="ui-icon-file-download"
                        pTooltip="Download"
                        tooltipPosition="top"
                        iconPos="center"
                        label=""
                      ></button>
                    </div>
                    <div
                      style="padding-right: 5px;padding-left: 5px;width: 45px;"
                      class="col-md-1 pull-right"
                    >
                      <button
                        pButton
                        type="button"
                        style="padding:0.5em 0"
                        class="ui-button-raised ui-button-secondary"
                        (click)="uploadProductFee()"
                        icon="ui-icon-file-upload"
                        iconPos="center"
                        pTooltip="Excel file: ProductCode, FeeName, Amount/Percentage, PaymentType, FeeType(Fixed/Percentage)"
                        tooltipPosition="top"
                        label=""
                      ></button>
                    </div>
                    <div class="col-md-3 col-sm-6 col-xs-12 pull-right">
                      <input
                        style="height:35px;"
                        class="form-control"
                        type="file"
                        (change)="handleFileInput($event.target.files)"
                        id="file1"
                        accept=".xls,.xlsx"
                        #fileInput
                        name="fileInput"
                        #fileInput
                        name="fileInput"
                      />
                    </div>
                  </div>
                </div>
                <p-table [value]="productProductFees" [(selection)]="selectedProductFee" [responsive]="true">
                  <ng-template pTemplate="caption">
                    <h4>Product Fee</h4>
                  </ng-template>
                  <ng-template pTemplate="header">
                    <tr>
                      <th class="checkbox_row">
                        <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
                      </th>
                      <th style="width:3em">S/N</th>
                      <th style="width:8em">Fee Name</th>
                      <th style="width:5em">
                        PaymentType
                      </th>
                      <!-- <th style="width:8em">FeeType</th> -->
                      <th style="width:8em">
                        Amount/Percentage
                      </th>
<!--                      <th style="width:3em"></th>-->
<!--                      <th style="width:4em"></th>-->
                    </tr>
                  </ng-template>
                  <ng-template pTemplate="body" let-x let-i="rowIndex">
                    <tr [pSelectableRow]="x">
                      <td class="checkbox_row">
                        <p-tableCheckbox
                          [value]="x"
                        ></p-tableCheckbox>
                      </td>
                      <td>{{ i + 1 }}</td>
                      <td><a (click)="editProductFee(x)" class="table_link">{{ x.productFeeName }}</a></td>
                      <td>
                        <a (click)="editProductFee(x)" class="table_link">{{ x.productPaymentTypeName }}</a>
                      </td>
                      <!-- <td>{{ x.productFeeType }}</td> -->
                      <td>
                        <a (click)="editProductFee(x)" class="table_link"> {{ x.productAmount }}</a>
                      </td>
<!--                      <td>-->
<!--                        <a (click)="editProductFee(x)">Edit</a>-->
<!--                      </td>-->
<!--                      <td>-->
<!--                        <a (click)="deleteProductFee(x)">Delete</a>-->
<!--                      </td>-->
                    </tr>
                  </ng-template>
                </p-table>
              </p-tabPanel>
              <p-tabPanel
                [disabled]="otherTabDisabled"
                header="Product Weighted Score"
              >
                <app-credit-weightedrisk-score-list
                  [productId]="productId"
                  [weightedRisk]="weightedRisk"
                ></app-credit-weightedrisk-score-list>
              </p-tabPanel>
            </p-tabView>
          </div>
        </div>
        <div class="panel-footer">
          <div class="row">
            <div class="col-md-12">
              <button
                *ngIf="activeIndex == 2"
                style="margin-right:5px"
                type="button"
                class="btn btn-primary pull-right"
                (click)="onSavedButtonPressed()"
              >
                Save
              </button>
              <button
                pButton
                type="button"
                class="btn btn-primary pull-right"
                *ngIf="activeIndex == 0"
                (click)="submitProductInfo(form)"
                icon="pi pi-less-than"
                iconPos="right"
                label="Next"
              ></button>
              <button
                pButton
                type="button"
                class="btn btn-primary pull-right"
                *ngIf="activeIndex > 0 && activeIndex < 2"
                (click)="openNext()"
                icon="pi pi-less-than"
                iconPos="right"
                label="Next"
              ></button>
              <button
                pButton
                type="button"
                class="btn btn-primary pull-right"
                style="margin-right:10px"
                *ngIf="activeIndex > 0"
                (click)="openPrev()"
                icon="pi pi-greater-than"
                iconPos="left"
                label="Previous"
              ></button>
              <button
                type="button"
                style="margin-right:5px"
                class="btn btn-danger pull-right"
                (click)="goBack()"
              >
                Close
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<p-dialog
  [responsive]="true"
  [(visible)]="displayProductFee"
  id="add-modal"
  modal="modal"
  showEffect="fade"
  width="800"
>
  <div style="margin-bottom:0" class="panel panel-default">
    <div class="panel-heading">
      <h2 class="panel-title">
        Product Fee
      </h2>
    </div>

    <form novalidate [formGroup]="productFeeForm">
      <div class="panel-body">
        <div class="form-horizontal">
          <div class="form-group">
            <label for="" class="control-label col-md-2">
              Fee
            </label>
            <div class="col-md-4">
              <select
                name="feeId"
                formControlName="feeId"
                id="feeId"
                class="form-control"
              >
                <option value="">-- Select Fee --</option>
                <option *ngFor="let row of feeList" [value]="row.feeId">
                  {{ row.feeName }}
                </option>
              </select>
            </div>

            <label for="" class="control-label col-md-2">
              Payment Type
            </label>
            <div class="col-md-4">
              <select
                type="text"
                name="productPaymentType"
                formControlName="productPaymentType"
                id="productPaymentType"
                class="form-control"
              >
                <option value="">-- Select Account Type --</option>
                <option
                 value="1"
                >
                  Upfront
                </option>
              </select>
            </div>
          </div>
          <div class="form-group">
            <label for="" class="control-label col-md-2">
              Fee Type
            </label>
            <div class="col-md-4">
              <select
                type="text"
                name="productFeeType"
                formControlName="productFeeType"
                id="productFeeType"
                class="form-control"
                (change)="onFeeTypeChange($event.target.value)"
              >
                <option value="">-- Select FeeType --</option>
                <option value="1">Fixed</option>
                <option value="2">Percentage</option>
              </select>
            </div>

            <label for="" class="control-label col-md-2">
              {{ amountTitle }}
            </label>
            <div class="col-md-4">
              <input
                type="text"
                formControlName="productAmount"
                name="productAmount"
                class="form-control"
              />
            </div>
          </div>
        </div>
      </div>
      <!--buttons-->

      <div class="panel-footer">
        <div class="row">
          <div class="col-md-12">
            <button
              type="submit"
              [disabled]="productFeeForm.invalid"
              (click)="submitProductFee(productFeeForm)"
              class="btn btn-success pull-right"
            >
              Save
            </button>
            <button
              type="button"
              (click)="displayProductFee = false"
              style="margin-right:5px"
              class="btn btn-danger pull-right"
            >
              Close
            </button>
          </div>
        </div>
      </div>
    </form>
  </div>
</p-dialog>
